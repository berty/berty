syntax = "proto3";

package berty.node;

import "api/p2p/event.proto";
import "entity/contact.proto";
import "entity/conversation.proto";
import "entity/message.proto";

option go_package = "github.com/berty/berty/core/api/node";

service Service {

  //
  // Events
  //

  rpc EventStream(Void) returns (stream berty.p2p.Event);  // yield new events in real-time
  rpc EventList(EventListInput) returns (stream berty.p2p.Event);    // list old events

  //
  // Contacts
  //

  rpc ContactRequest(ContactRequestInput) returns (berty.entity.Contact);
  rpc ContactAcceptRequest(berty.entity.Contact) returns (berty.entity.Contact);
  rpc ContactRemove(berty.entity.Contact) returns (berty.entity.Contact);
  rpc ContactUpdate(berty.entity.Contact) returns (berty.entity.Contact);
  rpc ContactList(Void) returns (stream berty.entity.Contact);

  //
  // Conversations
  //

  rpc ConversationCreate(berty.entity.Conversation) returns (berty.entity.Conversation);
  rpc ConversationList(Void) returns (stream berty.entity.Conversation);
  rpc ConversationInvite(berty.entity.ConversationMember) returns (berty.entity.Conversation);
  rpc ConversationAddMessage(ConversationAddMessageInput) returns (berty.p2p.Event);
  //rpc ConversationLeave(berty.entity.Conversation) returns (berty.entity.Conversation);
  //rpc ConversationJoinRequest(berty.entity.Conversation) returns (berty.entity.Conversation);
  //rpc ConverstionAcceptJoinRequest(berty.entity.Conversation) returns (berty.entity.Conversation);

  //
  // Devtools
  //

  // HandleEvent is the unencrypted (and unsafe) version of HandleEnvelope.
  // it's only exposed over the node API, it should be completely deactivated in public releases
  rpc HandleEvent(berty.p2p.Event) returns (Void) {};
}

message ContactRequestInput {
  berty.entity.Contact contact = 1;
  string intro_text = 2;
}

message ConversationAddMessageInput {
  berty.entity.Conversation conversation = 1;
  berty.entity.Message message = 2;
}

message EventListInput {
  uint32 limit = 1;
  berty.p2p.Event filter = 2;
}

message Void {}