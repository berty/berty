{{- if not (getStore "service.gen.graphql.header") -}}
# GENERATED CODE -- DO NOT EDIT!

scalar Enum
scalar Double
scalar Int64
scalar Uint64
scalar Int32
scalar Byte
scalar Fixed64
scalar Fixed32
scalar Bool
scalar Uint32
scalar SFixed64
scalar SFixed32
scalar SInt32
scalar SInt64
scalar GoogleProtobufTimestamp
scalar GoogleProtobufTimestampInput
scalar GoogleProtobufTimestampPayload

interface Node {
  id: ID!
}
{{setStore "service.gen.graphql.header" true}}
{{- end}}

{{- setStore "file" .File}}
{{- $file := getStore "file"}}

{{- range .File.MessageType }}
  {{- setStore (concat "." $file.Package "." .Name) .}}
{{- end}}

{{- range .File.EnumType}}
  {{/* - template "Enum" . */}}
{{- end}}

{{- range .File.MessageType}}
  {{- if .EnumType}}
    {{- setStore "message_name" .Name}}
    {{- range .EnumType}}
      {{/* - template "Enum" . */}}
    {{- end}}
  {{- end}}
  {{- if .NestedType}}
    {{ setStore "message_name" .Name}}
    {{- range .NestedType}}
      {{- template "Type" .}}
    {{- end}}
  {{- end}}
  {{- setStore "message_name" ""}}
  {{- template "Type" .}}
{{- end}}

{{- define "ImplementNode"}}
  {{- setStore "implement_node" false}}
  {{- range .Field}}
    {{- if (boolFieldExtension 53004 .)}}
      {{- setStore "implement_node" true}}
    {{- end}}
  {{- end}}
  {{- if (getStore "implement_node") -}}
    implements Node
  {{- end}}
{{- end}}

{{- define "ScalarField"}}
  {{- if (boolFieldExtension 53004 .)}}
    {{.JsonName}}: ID!
  {{- else}}
    {{- if eq (.Type | string) "TYPE_BYTES"}}
      {{.JsonName}}: [Byte!],
    {{- else}}
      {{- $typeName := .Type | string | replace "TYPE_" "" | lower | camelCase}}
      {{- if (boolFieldExtension 53008 .) true}}
      {{.JsonName}}: {{if isFieldRepeated .}}[{{$typeName}}!]{{else}}{{$typeName}}{{end}}
      {{- else}}
      {{.JsonName}}: {{if isFieldRepeated .}}[{{$typeName}}!]{{else}}{{$typeName}}!{{end}}
      {{- end}}
    {{- end}}
  {{- end}}
{{- end}}

{{- define "EnumField"}}
  {{- $typeName := .TypeName | replace "." "_" | camelCase | replace "_" ""}}
    {{.JsonName}}: {{if isFieldRepeated .}}[Enum]{{else}}Enum{{end}}
{{- end}}

{{- define "Field"}}
  {{- $messageName := getStore "message_name"}}

  {{- if .}}
    {{- range .}}
      {{- if (eq (.Type | string) "TYPE_MESSAGE")}}
        {{- if (boolFieldExtension 53006 .)}}
          {{- template "Field" (getStore .TypeName).Field}}
        {{- else}}
          {{- $typeName := .TypeName | replace "." "_" | camelCase | replace "_" ""}}
          {{- if eq (boolFieldExtension 53009 .) true}}
    {{.JsonName}}: {{if isFieldRepeated .}}[{{$typeName}}!]{{else}}{{$typeName}}!{{end}}
          {{- else}}
    {{.JsonName}}: {{if isFieldRepeated .}}[{{$typeName}}]{{else}}{{$typeName}}{{end}}
          {{- end}}
        {{- end}}
      {{- else if (eq (.Type | string) "TYPE_ENUM")}}
        {{- template "EnumField" .}}
      {{- else }}
        {{- template "ScalarField" .}}
      {{- end}}
    {{- end}}
  {{- else}}
    T: Boolean
  {{- end}}
{{- end}}

{{- define "ArgumentScalarField"}}
  {{- if (boolFieldExtension 53004 .)}}
    {{.JsonName}}: ID!
  {{- else}}
    {{- if eq (.Type | string) "TYPE_BYTES"}}
      {{.JsonName}}: [Byte!],
    {{- else}}
      {{- $typeName := .Type | string | replace "TYPE_" "" | lower | camelCase}}
      {{.JsonName}}: {{if isFieldRepeated .}}[{{$typeName}}!]{{else}}{{$typeName}}{{end}}
    {{- end}}
  {{- end}}
{{- end}}

{{- define "InputField"}}
  {{- $messageName := getStore "message_name"}}

  {{- if .}}
    {{- range .}}
      {{- if (eq (.Type | string) "TYPE_MESSAGE")}}
        {{- if (boolFieldExtension 53006 .)}}
          {{- template "InputField" (getStore .TypeName).Field}}
        {{- else}}
        {{- $typeName := .TypeName | replace "." "_" | camelCase | replace "_" ""}}
          {{- if eq (boolFieldExtension 53009 .) true}}
    {{.JsonName}}: {{if isFieldRepeated .}}[{{template "InputName" .TypeName}}!]{{else}}{{template "InputName" .TypeName}}!{{end}}
          {{- else}}
    {{.JsonName}}: {{if isFieldRepeated .}}[{{template "InputName" .TypeName}}]{{else}}{{template "InputName" .TypeName}}{{end}}
          {{- end}}
        {{- end}}
      {{- else if (eq (.Type | string) "TYPE_ENUM")}}
        {{- template "EnumField" .}}
      {{- else }}
        {{- template "ScalarField" .}}
      {{- end}}
    {{- end}}
  {{- else}}
    T: Boolean
  {{- end}}
{{- end}}

{{- define "Enum"}}
  {{- $file := getStore "file"}}
  {{- $messageName := getStore "message_name"}}

enum {{$file.Package | replace "." "_" | camelCase}}{{$messageName}}{{.Name}} {
  {{- range .Value}}
  {{.Name}}
  {{- end}}
}
{{- end}}

{{- define "Type"}}
  {{- $file := getStore "file"}}
  {{- $messageName := getStore "message_name"}}
  {{- if eq (concat .Name "") "Timestamp"}}
  {{- else if (and (eq (.Name | regexMatch ".*Input") false) (eq (.Name | regexMatch ".*Output") false)) }}
type {{$file.Package | replace "." "_" | camelCase}}{{$messageName}}{{.Name}} {{template "ImplementNode" .}} {
  {{- template "Field" .Field}}
}
  {{- end}}
{{- end}}

{{- define "Input"}}
  {{- $type := getStore .}}
  {{- if $type}}
    {{- if eq (concat $type.Name "") "Timestamp"}}
    {{- else}}
input {{template "InputName" .}} {
    {{- template "InputField" $type.Field}}
}
    {{- end}}
  {{- end}}
{{- end}}

{{- define "Payload"}}
  {{- $type := getStore .}}
  {{- if $type}}
    {{- if eq (concat $type.Name "") "Timestamp"}}
    {{- else }}
      {{- template "ImplementNode"}}
type {{template "PayloadName" .}} {{- template "ImplementNode"}} {
    {{- template "Field" $type.Field}}
}
    {{- end}}
  {{- end}}
{{- end}}

{{- define "InputName" }}
  {{- $type := getStore .}}
  {{- if $type}}
    {{- $typeName := . | replace "." "_" | camelCase | replace "_" ""}}
    {{- if $typeName | regexMatch ".*Input"}}
      {{- $typeName}}
    {{- else}}
      {{- $typeName}}Input
    {{- end}}
  {{- end}}
{{- end}}

{{- define "PayloadName" }}
  {{- $type := getStore .}}
  {{- if $type}}
    {{- $typeName := . | replace "." "_" | camelCase | replace "_" ""}}
    {{- if $typeName | regexMatch ".*Connection"}}
      {{- $typeName}}
    {{- else if $typeName | regexMatch ".*Output"}}
      {{- $typeName | replace "Output" "Payload"}}
    {{- else}}
      {{- $typeName}}Payload
    {{- end}}
  {{- end}}
{{- end}}

{{- define "RecursiveInput"}}
  {{- $type := getStore .}}
  {{- if $type}}
    {{- range $type.Field}}
      {{- $typeName := .TypeName}}
      {{- if $typeName}}
        {{- $type := getStore $typeName}}
        {{- $alreadyDefinedKey := concat $typeName ".InputAlreadyDefined"}}
        {{- $alreadyDefined := getStore $alreadyDefinedKey}}
        {{- if $alreadyDefined}}
        {{- else}}
          {{- template "RecursiveInput" $typeName}}
          {{- template "Input" $typeName}}
        {{- end}}
        {{- setStore $alreadyDefinedKey true}}
      {{- end}}
    {{- end}}
  {{- end}}
{{- end}}

{{- block "InputPayload" .File.Service}}
  {{- $file := getStore "file"}}
  {{- range .}}
    {{- range .Method}}
      {{- $methodName := .Name}}
      {{- if .InputType}}
        {{- template "RecursiveInput" .InputType}}
      {{- end}}
      {{- if (stringMethodOptionsExtension 53007 .)}}
        {{- if eq ((stringMethodOptionsExtension 53007 .) | regexMatch ".*(Payload|Connection)$") false}}
          {{- $type := getStore (stringMethodOptionsExtension 53007 .)}}
          {{- $alreadyDefinedKey := concat (stringMethodOptionsExtension 53007 .) ".PayloadAlreadyDefined"}}
          {{- $alreadyDefined := getStore $alreadyDefinedKey}}
          {{- if $alreadyDefined}}
          {{- else}}
              {{- template "Payload" (stringMethodOptionsExtension 53007 .)}}
          {{- end}}
          {{- setStore $alreadyDefinedKey true}}
        {{- end}}
      {{- else if .OutputType}}
        {{- if eq (.OutputType | regexMatch ".*(Payload|Connection)$") false}}
          {{- $alreadyDefinedKey := concat .OutputType ".PayloadAlreadyDefined"}}
          {{- $alreadyDefined := getStore $alreadyDefinedKey}}
          {{- if $alreadyDefined}}
          {{- else}}
              {{- template "Payload" .OutputType}}
          {{- end}}
          {{- setStore $alreadyDefinedKey true}}
        {{- end}}
      {{- end}}
    {{- end}}
  {{- end}}
{{- end}}

{{- define "Method"}}
  {{.Name}}
  {{- if .InputType -}}
  (
    {{- template "Arguments" (getStore .InputType).Field}}
  )
  {{- end}}
  {{- if (stringMethodOptionsExtension 53007 .) -}}
      : {{template "PayloadName" (stringMethodOptionsExtension 53007 .)}}
  {{- else if .OutputType}}
    {{- if .ServerStreaming -}}
      : [{{template "PayloadName" .OutputType}}]
    {{- else -}}
      : {{template "PayloadName" .OutputType}}
    {{- end}}
  {{- end}}
{{- end}}

{{- define "Arguments"}}
  {{- $messageName := getStore "message_name"}}

  {{- if .}}
    {{- range .}}
      {{- if (eq (.Type | string) "TYPE_MESSAGE")}}
        {{- if (boolFieldExtension 53006 .)}}
          {{- template "Arguments" (getStore .TypeName).Field}}
        {{- else}}
    {{.JsonName}}: {{if isFieldRepeated .}}[{{template "InputName" .TypeName}}]{{else}}{{template "InputName" .TypeName}}{{end}}
        {{- end}}
      {{- else if (eq (.Type | string) "TYPE_ENUM")}}
        {{- template "EnumField" .}}
      {{- else }}
        {{- template "ScalarField" .}}
      {{- end}}
    {{- end}}
  {{- else}}
      T: Boolean
  {{- end}}
{{- end}}

{{- block "Query" .File.Service}}
  {{$file := getStore "file"}}

  {{- range .}}
type Query {
  node(id: ID!): Node
    {{- range .Method}}
      {{- if eq (stringMethodOptionsExtension 53002 . | lower) "query"}}
        {{- template "Method" .}}
      {{- end}}
    {{- end}}
}
  {{- end}}
{{- end}}

{{- block "Mutation" .File.Service}}
  {{$file := getStore "file"}}

  {{- range .}}
type Mutation {
    {{- range .Method}}
      {{- if eq (stringMethodOptionsExtension 53002 . | lower) "mutation"}}
        {{- template "Method" .}}
      {{- end}}
    {{- end}}
}
  {{- end}}
{{- end}}

{{- block "Subscription" .File.Service}}
  {{$file := getStore "file"}}

  {{- range .}}
type Subscription {
    {{- range .Method}}
      {{- if eq (stringMethodOptionsExtension 53002 . | lower) "subscription"}}
  {{.Name}}
  {{- if .InputType -}}
  (
    {{- template "Arguments" (getStore .InputType).Field}}
  )
  {{- end}}
  {{- if .OutputType}}: {{template "PayloadName" .OutputType}}{{- end}}
      {{- end}}
    {{- end}}
}
  {{- end}}
{{- end}}
