{{- if eq (lower .File.Name) "api/p2p/kind.proto"}}// file generated by protoc-gen-gotemplate

package p2p

import "github.com/gogo/protobuf/proto"

  {{- range .File.MessageType}}
    {{- $oo := .Name | trunc (int (sub (len .Name) 5)) }}

    // Get{{ $oo }}Attrs is a typesafe version of GetAttrs
    func (e *Event) Get{{ $oo }}Attrs() (*{{$oo}}Attrs, error) {
      if e.Attributes == nil || len(e.Attributes) == 0 {
        return &{{$oo}}Attrs{}, nil
      }
      {{- /* e.Attributes = &Event_{{$oo}}Attrs{{`{`}}{{$oo}}Attrs: &attrs} */}}
      var attrs {{$oo}}Attrs
      return &attrs, proto.Unmarshal(e.Attributes, &attrs)
    }

    // Set{{$oo}}Attrs is a typesafe version of the generic SetAttrs method
    func (e *Event) Set{{$oo}}Attrs(attrs *{{$oo}}Attrs) error {
      raw, err := proto.Marshal(attrs)
      if err != nil {
        return err
      }
      e.Attributes = raw
      return nil
    }
  {{- end}}

  // GetAttrs parses the embedded attributes
  func (e *Event) GetAttrs() (proto.Message, error) {
    switch e.Kind {
      {{- range .File.MessageType}}
        {{- $oo := .Name | trunc (int (sub (len .Name) 5)) }}
        case Kind_{{$oo}}:
          return e.Get{{$oo}}Attrs()
      {{- end }}
    }
    return nil, fmt.Errorf("not supported event kind: %q", e.Kind)
  }

{{- end }}