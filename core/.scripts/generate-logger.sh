#!/bin/sh -e

for pkg in $(git grep func\ | grep .go: | cut -d: -f1 | uniq | xargs -n1 dirname | uniq); do
    echo "+ generate $pkg/logger.gen.go"
    logname="core."$(echo $pkg | tr / .)
    pkgname=$(basename $pkg)

    if grep "package main" $pkg/*.go >/dev/null 2>/dev/null; then
        pkgname="main"
    fi

    cat > $pkg/logger.gen.go <<EOF
// Code generated by berty.tech/core/.scripts/generate-logger.sh

package $pkgname

import "go.uber.org/zap"

func logger() *zap.Logger {
     return zap.L().Named("$logname")
}

EOF
done

set -x
goimports -w .
